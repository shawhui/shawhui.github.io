# QUIC 实践

在 2022年6月6日, IETF正式标准化 HTTP/3 为 RFC9114。各浏览器、客户端等开始支持 HTTP/3 协议，那么 HTTP/3 协议在互联网中表现如何？ 

## QUIC 可用性验证

爱奇艺 QLB 团队曾对 HTTP/3 基于 A/B 测试的方式，对 HTTP/1.1、HTTP/2、HTTP/3 等各版本协议进行可用性测试，本文将测试数据分享，以供读者参考

测试的客户端为 iOS 支持 H3-29草案、及HTTP3 协议，根据内部 A/B 实验，如果命中便优先进行 QUIC 协议请求，如果未命中策略，则走 HTTP/2 或者 http/1.1 （ 但不能保证一定会走到QUIC，网络库内部会有一套竞速策略来择选最后的请求是HTTP还是QUIC）。


### 1.各协议耗时表现

根据用户网络状态分级，进行综合性比较, 在同等网络环境条件下 HTTP/3 或 H3-29 约有一倍效率提升（耗时单位ms）。

<div  align="center">
	<img src="../assets/quic-1.png" width = "660"  align=center />
</div>


### 2.各协议成功率表现

<div  align="center">
	<img src="../assets/quic-3.png" width = "660"  align=center />
</div>

继续看网络请求成功率的对比，综合来看 HTTP3 或 H3-29 的失败率更高。

## 小结

无论是在客户端还是服务端，QUIC协议的集成并非一件易事，下面让我们来看看客户端和服务端在集成QUIC协议时需要考虑的问题：

### 客户端的问题

- 应用适配成本和收益之间的权衡。
- 过渡期可能还需要新旧网络库都存在，方便降级容错，增加应用体积。
- 不同的QUIC库的接口并不统一，不像Socket统一接口具备移植性。

### 服务端的问题

- 网络事件模型需要适配QUIC协议栈做调整，同时还要考虑和TCP的兼容。
- 后端架构面临调整，4层Load Balancer是否支持QUIC，HTTP/3的QUIC流量如何换成HTTP/1转给Backend Service。
- 需要考虑到多Region、多节点之间的QUIC连接复用和连接迁移。
- 服务端 QUIC 流量的能耗比，如何做到和 TCP 一样的能耗性能。

综合来看，HTTP/3 大规模的应用还需要一定的时间。