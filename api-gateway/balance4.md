# 四层负载均衡

四层负载均衡有很多种实现，最经典的莫过于基于内核 netfilter 的对IP数据包路由分发的 LVS。

在高可用性的架构中，一般通过等价路由或者冗余路由协议，虚拟出一个VIP，内部实现多台双活或主备的方式，四层的方案仅作为流量入口处理IP数据包转发，无法识别上层协议，灵活性很差，但性能指标较好，一般用pps(包转发/秒)衡量性能。

在企业应用中，通常用四层负载均衡实现配合OSPF实现多活入口，再配合后端七层的应用协议处理网关。

## 四层负载均衡方案的发展

像微信、抖音、快手、爱奇艺这类国民级的应用，每天会产生数以几十亿、甚至百亿级的请求，再加上内部数据中心数以千计、万计的服务体系，这种规模级的数据包转发与处理，对于传统的 Linux 网络有很大的瓶颈和挑战。

现在业内解决思路有跳过内核协议栈、FPGA加速等方案，部分头部的互联网企业也公开了很多优化的开源实现，如爱奇艺基于 DPDK 的开源版本 DPVS，Facebook 基于 eBPF 技术的 Katran、字节基于 FPGA 加速的Tiara等。

这些方案可以实现单机 C10M 性能指标，让硬件充分发挥性能。